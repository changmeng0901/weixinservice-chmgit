<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>商品详情页</title>
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="../style/Buy/reset.css">
    <link rel="stylesheet" href="../style/Buy/swiper.min.css">
	<link rel="stylesheet" href="../style/Buy/product_detail.css">
</head>
<body>
	<div class="swiper-container">
        <div class="swiper-wrapper"></div>
        <!-- Add Pagination -->
        <div class="swiper-pagination"></div>
        <!-- logo -->
        <div class="logo" id="logo"><img src="../images/Buy/logo.jpg" /></div>
        <div class="edit"><a href=""><img src="../images/Buy/edit.png" ></a></div>
    </div>
    <div class="title">
    	<p class="content">
    		<span class="txt" id="product_name">【纯天然绿色】车厘子 产自加拿大进口的车厘子</span>
    		<span class="tip"><i id="freefreight_price_flag">包邮</i>满<code id="free_freight_price">50</code>元包邮</span>
    	</p>
    	<p class="prize"><i>￥</i><span id="product_price">5.00</span></p>
    </div>
    <div class="detail">
    	<p class="line" style="border-bottom:1px solid #e1e1e1;"><span class="fl">运费<i id="freight_price">￥10.00</i></span><span class="fr">销量 <i id="sale_num">5022</i>笔</span></p>
    	<div class="line" id="enter_SPEC">
        	<span class="text_name fl">已选<i id="option_product">500g加拿大车厘子</i></span>
            <div class="fr inputBox">
            	<span class="fl" id="Subtract"><img src="../images/Buy/icon_jian.jpg" /></span>
                <input type="text" value="1" class="fl" id="Total" />
                <span class="fr" id="Addition"><img src="../images/Buy/icon_jia.jpg" /></span>
            </div>
        </div>
    </div>
    <div class="show">
    	<h4><span class="line"></span><span>农场风光</span><span class="line"></span></h4>
    	<div class="pic" id="krpanos">
    		<img src="../images/Buy/pic_bg.jpg" />
    		<i class="icon1"></i>
    		<p>#四季田景#</p>
    		<div class="mask"></div>
    	</div>
        <div class="pic" id="aerial_video">
            <img src="../images/Buy/pic_bg.jpg" />
            <i class="icon2"></i>
            <p>#航拍视频#</p>
            <div class="mask"></div>
        </div>
        <div class="pic" id="farm_show">
            <img src="../images/Buy/pic_bg1.jpg" />
            <i class="icon3"></i>
            <p>#农场秀#</p>
            <div class="mask"></div>
            <div class="phone">
                <img src="" alt="">
            </div>
        </div>
    </div>
    <div class="show">
        <h4><span class="line"></span><span>绿色履历</span><span class="line"></span></h4>
        <div class="pic" id="resume">
            <img src="../images/Buy/pic_bg2.jpg" />
            <i class="icon4"></i>
            <p>#商品履历#</p>
            <div class="mask"></div>
            <div class="phone">
                <img src="" alt="">
            </div>
        </div>
    </div>
    <div class="show">
        <h4><span class="line"></span><span>农场地图</span><span class="line"></span></h4>
        <div class="pic map" id="farm_map">
            <img src="../images/Buy/map.jpg" />
        </div>
    </div>
    <div class="tabs">
        <ul class="item">
            <li class="cur">商品详情</li>
            <li id="Evaluate">评价<span>（8）</span></li>
        </ul>
        <div class="details current">
            <div class="goods_pic" id="product_introduction"></div>
            <div class="show" style="border-bottom:0; padding:0;">
                <h4><span class="line"></span><span>精选商品</span><span class="line"></span></h4>
                <ul class="fruit clearfix" id="fruit_list"></ul>
            </div>
        </div>
        <div class="details">
            <!-- 有评价 -->
            <ul class="evaluate" id="evaluate">
                <li>
                    <div class="top_line">
                        <span class="photo fl"><img src="../images/Buy/photo.png" alt=""></span>
                        <span class="tel fl">139*****1522</span>
                        <span class="date fr">2016-09-18</span>
                    </div>
                    <div class="stars">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star2.png" alt="">
                    </div>
                    <p class="txt">可以买过两次了</p>
                </li>
                <li>
                    <div class="top_line">
                        <span class="photo fl"><img src="../images/Buy/photo.png" alt=""></span>
                        <span class="tel fl">139*****1522</span>
                        <span class="date fr">2016-09-18</span>
                    </div>
                    <div class="stars">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star1.png" alt="">
                        <img src="../images/Buy/star2.png" alt="">
                    </div>
                    <p class="txt">可以买过两次了</p>
                    <div class="pics">
                        <img src="../images/Buy/apple.jpg" alt="">
                        <img src="../images/Buy/apple.jpg" alt="">
                        <img src="../images/Buy/apple.jpg" alt="">
                        <img src="../images/Buy/apple.jpg" alt="">
                    </div>
                </li>
            </ul>
            <!-- 没评价 -->
            <div class="no_evaluate">
                <img src="../images/Buy/txt.png" alt="">
                <p>暂无评价</p>
            </div>
        </div>
        <div class="load_more"><p>加载中...</p></div>
    </div>
    
    <div class="copyRight">Copyright北京奥科美技术服务有限公司</div>
    <ul class="purchase">
        <li class="nub1">
            <a href="cart.html">
               <img src="../images/Buy/cart.png" />
                <i>1</i>
                <p>购物车</p> 
            </a> 
        </li>
        <li class="nub2" id="AddCart">加入购物车</li>
        <li class="nub3">立即购买</li>  
    </ul>
</body>
<script type="text/javascript" src="../js/commons/jquery-1.11.3.min.js"></script>
<script type="text/javascript" src="../js/commons/jquery.lazyload.js"></script>
<script type="text/javascript" src="../js/swiper/swiper.min.js"></script>
<script>
$(document).ready(function() {
	
	var sumCount='';
	//设置font-size
	var fontsize = 16 * $(window).width() / 320;
	$('html').css('font-size',fontsize);
	//rem设置结束
	 
	//图片懒加载
	$("img").lazyload({
		effect: "fadeIn"
	});
	
	var LocationHttp = 'http://192.168.21.187:8081'; 
	var makeParameterMethod,
    makeParameterField,
    ParameterMethod,
    ParameterField,
    pageUrl;
	
	//SEARCH
	var iframeSearch = location.search.split("&");
	var getProductId = iframeSearch[0].split("=")[1];
	var getEnterpriseId = iframeSearch[1].split("=")[1];
	var getTestUrl = iframeSearch[2].split("=")[1];
	makeParameterMethod =  function (string) {
		var Method = '&method=' + string;
		return Method;
	}
	makeParameterField = function (ProductId,ID,EnterpriseId,ID2) { 
		return encodeURI('&field={"'+ProductId+'":"'+ID+'","'+EnterpriseId+'":"'+ID2+'"}');
	}
	makeParameterFieldPage = function (ProductId,ID,EnterpriseId,ID2,Page,Num) { 
		return encodeURI('&field={"'+ProductId+'":"'+ID+'","'+EnterpriseId+'":"'+ID2+'","'+Page+'":"'+Num+'"}');
	}
	//URL
	ParameterMethod = makeParameterMethod('product.info.data');
	ParameterField = makeParameterField('product_id',getProductId,'enterprise_info_id',getEnterpriseId);
	pageUrl = getTestUrl +"/rest/1.0/purchase?v=1.0&format=json"+ ParameterMethod + ParameterField;
	//console.log(pageUrl)
	//AJAX
	$.ajax({
		type: "GET",
		timeout: 1000,
		url: pageUrl,
		dataType: "jsonp",
		jsonp: 'callback',
		success: function(response) {
			
			InitInforData(response.purchase_product_info);			
			
		},
		error: function(e) {
			try {
				console.log('商品详情请求失败了吧！！')
			} catch (e) {}
		}
	});
	
	
	
	// 商品详情选项卡
	$('.tabs .item li').click(function() {
		var index = $(this).index();
		$(this).addClass('cur').siblings().removeClass('cur');
		$('.details').eq(index).addClass('current').siblings().removeClass('current');
	});
	
	//进入到规格选择页
	$('#option_product').click(function(){
		window.location.href = LocationHttp+'/weixinservice/Buy/specification.html?product_id='+ getProductId +'&enterprise_info_id='+getEnterpriseId +'&domain='+getTestUrl 
	});
	
	//加减计算
	$('#Subtract').click(function(){//减，最小为1
		var _num = Number($('#Total').val())-1;
		if( _num <= 1 ){ _num = 1 }
		$('#Total').val( _num );	
	});
	$('#Addition').click(function(){//加，最大为99
		var _num = Number($('#Total').val())+1;
		if( _num >= 99 ){ _num = 99 }
		$('#Total').val( _num );	
	});

	//初始化参数
	var InitInforData = function(_data){
		//logo  Logo是否启用 1是 0不
		if( _data.logo.logo_flag == 0 ){
			$('#logo').hide();
		}else{
			$('#logo').show();
			$('#logo img').attr('src',_data.logo.logo_url);
		}
		//商品名称
		_data.product_name==''|| _data.product_name=='undefined' ?  $('#product_name').html('--') : $('#product_name').html( _data.product_name )
		//价格
		_data.product_price==''|| _data.product_price=='undefined' ? $('#product_price').html('--') : $('#product_price').html( _data.product_price )
		//是否免邮 1免邮 0不免
		if( _data.freight.freefreight_price_flag == 0 ){
			$('#freefreight_price_flag').html('不包邮');
		}else{
			$('#freefreight_price_flag').html('包邮');	
		}
		//运费价格
		_data.freight.freight_price==''|| _data.freight.freight_price=='undefined' ? $('#freight_price').html('￥--') : $('#freight_price').html( _data.freight.freight_price )
		//需满免邮
		_data.freight.free_freight_price==''|| _data.freight.free_freight_price=='undefined' ? $('#free_freight_price').html('--') : $('#free_freight_price').html( _data.freight.free_freight_price )
		//规格
		_data.option_product==''|| _data.option_product=='undefined' ? $('#option_product').html('--') : $('#option_product').html( _data.option_product )
		//销量
		_data.sale_num==''|| _data.sale_num=='undefined' ?  $('#sale_num').html('--') : $('#sale_num').html( _data.sale_num )
		//是否启用四季田景 1是 0 不
		if( _data.krpanos.krpanos_flag == 0 ){
			$('#krpanos').hide();
		}else{
			$('#krpanos').show();	
			$('#krpanos img').attr('src',_data.krpanos.krpanos_image_url);
			$('#krpanos p').attr('krpanos_group_id',_data.krpanos.krpanos_group_id);
		}
		//是否启用航拍 1是 0 不
		if( _data.aerial_video.aerial_video_flag == 0 ){
			$('#aerial_video').hide();
		}else{
			$('#aerial_video').show();	
			$('#aerial_video img').attr('src',_data.aerial_video.aerial_video_image_url);
			$('#aerial_video p').attr('aerial_video_group_id',_data.aerial_video.aerial_video_group_id);
		}
		//是否启用农场秀 1是 0 不
		if( _data.farm_show.farm_show_flag == 0 ){
			$('#farm_show').hide();
		}else{
			$('#farm_show').show();	
			$('#farm_show img').attr('src',_data.farm_show.farm_show_image_url);
			$('#farm_show p').attr('farm_show_group_id',_data.farm_show.farm_show_group_id);
		}
		//是否启用履历 1是 0 不
		if( _data.resume.resume_flag == 0 ){
			$('#resume').hide();
		}else{
			$('#resume').show();	
			$('#resume img').attr('src',_data.resume.phone_model_info_image_url);
			$('#resume p').attr('resume_id',_data.resume.resume_id);
		}
		//是否启用农场地图 1是 0 不
		if( _data.farm_map.farm_map_flag == 0 ){
			$('#farm_map').hide();
		}else{
			$('#farm_map').show();	
			$('#farm_map img').attr('src',_data.farm_map.farm_map_image_url);
			$('#farm_map p').attr('farm_map_id',_data.farm_map.farm_map_id);
		}
		
		//如果精选商品列表不为空，则执行精选商品列表函数
		if( !_data.product_list=='' || !_data.product_list==[] || _data.product_list=='undefined' ){
			ProductListData(_data.product_list.purchase_product_list);
		}
		//商品详情，图片
		if( !_data.product_introduction == '' || !_data.product_introduction == 'undefined' ){
			$('#product_introduction').append( _data.product_introduction );
		}
		
		//所有分页的数据条数总和：为：
		_data.total_page==''|| _data.total_page=='undefined' ?  sumCount = 0 : sumCount = _data.total_page;
		
		//商品展示图片,函数执行
		SwiperListData(_data.product_image);
		
		
	}//-------初始化参数结束
	
	//商品展示图片   SWIPER函数
	var SwiperListData = function(_data){
		if( !_data=='' || !_data==[] || _data=='undefined' ){
			var _slider = '';
			var $swiperContainer = $('.swiper-container .swiper-wrapper');
			for( var k=0;k<_data.length;k++ ){
				_slider += '<div class="swiper-slide"><a href="javascript:;"><img src="'+ _data[k] +'" ></a></div>';	
			}
			$swiperContainer.append( _slider );
			//轮播图
			var swiper1 = new Swiper('.swiper-container', {
				pagination: '.swiper-pagination',
				paginationClickable: true, //值为真时，当单击指示器时会执行过渡动画到目标slide...
				autoplay: 3000,
				speed : 500,
				autoplayDisableOnInteraction: false,  //触摸后状态，true之后停止自动播放，false之后还可以自动播放
				loop : true, //无限循环切换
			});	
		}
		
	}//--------------end
	
	//精选商品列表函数
	var $fruit_list = $('#fruit_list');
	var ProductListData = function(_data){
		var _list='',
			_classname = '';
		if( !_data==[] || !_data=='undefined' ){
				for( var i=0;i<_data.length;i++ ){
					//取膜，基数class=right_b,偶数class=left_b
					i%2==0 ? _classname='right_b' : _classname='left_b'
					//拼接精选商品列表
					_list += 
					'<li class="'+ _classname +'">'+
						'<a href="">'+
							'<img src="'+ _data[i].image_url +'" />'+
							'<h6>'+ _data[i].product_name +'</h6>'+
							'<p class="prize">￥'+ _data[i].product_price +'</p>'+
						'</a>'+
					'</li>';
				}
				$fruit_list.append( _list );
		}		
	}//--------------end
	
	// 上拉加载
	var page = 1;
	$(window).on('touchmove',function(){
		var scrollH = $(document).scrollTop();
		//console.log(($(window).height() + scrollH) + ':' +($(document).height()))
		if( ($(window).height() + scrollH) >= $(document).outerHeight() ){
			page++;	
			if( page <= sumCount/4 ){
				$('.load_more p').html('加载中...');
				$('.load_more').show();
				setTimeout(function(){
					$('.load_more').hide();
					LoadingMore( page );
				},500);		
			}else{
				$('.load_more p').html('已经没有更多数据了');
				$('.load_more').show();
				setTimeout(function(){
					$('.load_more').hide();
				},500);		
			}
		}	
	});
	var LoadingMore = function( pageIndex ){
		ParameterMethod = makeParameterMethod('option.product.list.data');
		ParameterFieldPage = makeParameterFieldPage('product_id',getProductId,'enterprise_info_id',getEnterpriseId,'page',pageIndex);
		pageUrl =  getTestUrl +"/rest/1.0/purchase?v=1.0&format=json"+ ParameterMethod + ParameterFieldPage;
		$.ajax({
			type: "GET",
			timeout: 1000,
			url: pageUrl,
			dataType: "jsonp",
			jsonp: 'callback',
			success: function( response ) {
				var _list='',
					_classname = '';
				if( !_data=='' ||　!_data==[] || !_data=='undefined' ){
						for( var i=0;i<_data.length;i++ ){
							//取膜，基数class=right_b,偶数class=left_b
							i%2==0 ? _classname='right_b' : _classname='left_b'
							//拼接精选商品列表
							_list += 
							'<li class="'+ _classname +'">'+
								'<a href="">'+
									'<img src="'+ _data[i].image_url +'" />'+
									'<h6>'+ _data[i].product_name +'</h6>'+
									'<p class="prize">￥'+ _data[i].product_price +'</p>'+
								'</a>'+
							'</li>';
						}
						$fruit_list.append( _list );
				}			
				
			},
			error: function(e) {
				try {
					console.log('规格页请求失败了吧！！')
				} catch (e) {}
			}
		});	
	}
	
	//点击评价事件
	$('#Evaluate').click(function(){
		alert('加载评价')
	});
	//加入购物车事件
	$('#AddCart').click(function(){
		
	});
	
	
	//windowResize
	$(window).resize(function(){
		var fontsize = 16 * $(window).width() / 320;
		$('html').css('font-size',fontsize);
	});
	
});
//----------------------------onload之后的独立函数，如下：--------------------------------------------------------------------
//------------------------------------------------------------------------------------------------


</script>
</html>